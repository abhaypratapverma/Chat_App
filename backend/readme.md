#EASY TO READ INSTRUCTIONS


Chat App (Microservices Architecture)
ğŸš€ Project Overview

This repository hosts a microservices-based Chat Application, designed with scalability, modularity, and real-time communication in mind.

The system is divided into three backend services and one frontend module:

ğŸ§© Microservices Overview
Service	Description	Key Files
backend/user	Handles user authentication (OTP-based), profile management, and user CRUD operations.	src/index.ts
, controllers/user.ts

backend/mail	Consumes RabbitMQ messages and sends OTP emails using Nodemailer.	src/index.ts
, consumer.ts

backend/chat	Manages chats and messages, including text and image uploads via Cloudinary.	src/index.ts
, controllers/chat.ts

frontend	Client interface (React or similar). (Implementation details not included in this snapshot)	â€”
ğŸ¯ Purpose

Enable users to:

Log in securely via OTP email verification.

Create personal and group chats.

Send text and image messages.

Retrieve chat lists with unseen message counts.

ğŸ§° Tech Stack

Node.js + TypeScript â€” for scalable, type-safe microservices.

Express.js â€” for RESTful APIs.

MongoDB + Mongoose â€” for structured data storage.

Redis â€” for OTP storage and rate-limiting.

RabbitMQ â€” for asynchronous inter-service messaging.

Cloudinary â€” for image storage.

Nodemailer â€” for sending OTP emails.

JWT â€” for user authentication and authorization.

âš™ï¸ Key Features

âœ… OTP-based Login Flow â€” Secure authentication using email OTPs stored in Redis.
âœ… Microservice Communication via RabbitMQ â€” Decouples email sending from authentication flow.
âœ… Real-time Chat Management â€” Create, manage, and fetch chats and messages seamlessly.
âœ… Image Uploads â€” Integrated Cloudinary with Multer middleware.
âœ… JWT Authentication â€” Tokens generated by user service, verified across services.
âœ… Centralized Error Handling â€” TryCatch utility for consistent error management.

ğŸ—ï¸ System Architecture
ğŸ“ Folder Structure
backend/
â”œâ”€â”€ user/
â”‚   â””â”€â”€ src/
â”‚       â”œâ”€â”€ controllers/
â”‚       â”œâ”€â”€ config/
â”‚       â”œâ”€â”€ middleware/
â”‚       â”œâ”€â”€ model/
â”‚       â”œâ”€â”€ routes/
â”‚       â””â”€â”€ index.ts
â”œâ”€â”€ chat/
â”‚   â””â”€â”€ src/
â”‚       â”œâ”€â”€ controllers/
â”‚       â”œâ”€â”€ models/
â”‚       â”œâ”€â”€ middlewares/
â”‚       â”œâ”€â”€ config/
â”‚       â”œâ”€â”€ routes/
â”‚       â””â”€â”€ index.ts
â””â”€â”€ mail/
    â””â”€â”€ src/
        â”œâ”€â”€ consumer.ts
        â””â”€â”€ index.ts

ğŸ”„ Inter-Service Communication

RabbitMQ â†’

user-service publishes to the send-otp queue.

mail-service listens and sends emails accordingly.

Service Integration â†’

chat-service calls user-service APIs via Axios to fetch user details.

Authentication Flow â†’

JWT tokens generated by user-service (generateToken.ts).

Verified in both chat and user services using isAuth middleware.

ğŸ§© Design Decisions

Microservice Separation â€” Ensures scalability and modularity.

Pub/Sub Email Delivery â€” Increases fault tolerance and performance.

Redis-backed OTP System â€” Fast, secure, and temporary data storage.

Mongoose Models â€” Data consistency and schema validation.

Unified Error Handling â€” Using custom TryCatch utility.

ğŸ§ª Setup & Installation (Local)
ğŸ§± Prerequisites

Ensure you have:

Node.js â‰¥ 18

npm

MongoDB

Redis

RabbitMQ

Cloudinary account

SMTP credentials (e.g., Gmail)

âš™ï¸ Steps to Run Locally
# 1. Clone the repository
git clone <your_repo_url>
cd chat-app

# 2. Install dependencies for all services
backend/user â€” packages
Dependencies (to install with npm i):

amqplib@^0.10.8
cors@^2.8.5
dotenv@^17.2.1
express@^5.1.0
jsonwebtoken@^9.0.2
mongoose@^8.17.1
DevDependencies (to install with npm i -D):

@types/amqplib@^0.10.7
@types/cors@^2.8.19
@types/dotenv@^8.2.3
@types/express@^5.0.3
@types/jsonwebtoken@^9.0.10
@types/mongoose@^5.11.97
concurrently@^9.2.0
nodemon@^3.1.10
Install commands (PowerShell):

backend/chat â€” packages
Dependencies:

axios@^1.12.2
cloudinary@^1.41.3
dotenv@^17.2.3
express@^5.1.0
jsonwebtoken@^9.0.2
mongoose@^8.19.1
multer@^2.0.2
multer-storage-cloudinary@^4.0.0
DevDependencies:

@types/axios@^0.9.36
@types/dotenv@^6.1.1
@types/express@^5.0.3
@types/jsonwebtoken@^9.0.10
@types/multer@^2.0.0
concurrently@^9.2.1
prettier@^3.6.2
Install commands (PowerShell):

backend/mail â€” packages
Dependencies:

amqplib@^0.10.9
dotenv@^17.2.2
express@^5.1.0
nodemailer@^7.0.6
DevDependencies:

@types/amqplib@^0.10.7
@types/dotenv@^6.1.1
@types/express@^5.0.3
@types/nodemailer@^7.0.1
concurrently@^9.2.1
Install commands (PowerShell):



# 3. Configure environment variables for each service
cp .env.example .env   # (or manually create)

# 4. Run each service in separate terminals
cd backend/user && npm run dev
cd backend/chat && npm run dev
cd backend/mail && npm run dev

# 5. Start frontend
cd frontend && npm start

ğŸ” Environment Variables
Variable	Description	Example
PORT	Server port	5001
MONGO_URI	MongoDB connection URI	mongodb://localhost:27017/chatdb
JWT_SECRET	JWT signing key	mysecretkey
REDIS_URL	Redis connection URL	redis://localhost:6379
RABBITMQ_URL	RabbitMQ connection URL	amqp://localhost
CLOUDINARY_URL	Cloudinary API URL	cloudinary://api_key:secret@cloud_name
SMTP_USER	Mail service user	example@gmail.com
SMTP_PASS	Mail service password	app_specific_password
ğŸ“¡ API Overview
ğŸ‘¤ User Service
Endpoint	Method	Description
/api/v1/user/login	POST	Send OTP to userâ€™s email.
/api/v1/user/verify-otp	POST	Verify OTP and issue JWT token.
/api/v1/user/profile	GET	Get logged-in user profile.
ğŸ’¬ Chat Service
Endpoint	Method	Description
/api/v1/chat	POST	Create a new chat.
/api/v1/chat/all	GET	Fetch all user chats.
/api/v1/chat/:id/messages	GET	Get all messages for a chat.
/api/v1/chat/send	POST	Send a message (text or image).

(Refer to each serviceâ€™s routes folder for complete details.)

ğŸ–¼ï¸ Example Flow: OTP Authentication

User enters email â†’ POST /api/v1/user/login

OTP generated, stored in Redis â†’ published to RabbitMQ queue

Mail service listens â†’ sends OTP email

User enters OTP â†’ POST /api/v1/user/verify-otp

JWT token generated and returned â†’ used for all further requests

ğŸ§  Design Patterns & Utilities

TryCatch Wrapper for cleaner async controller handling.

Modular Configuration Files for database, RabbitMQ, and Cloudinary.

Secure Middleware Layers for authentication and validation.

ğŸš€ Deployment

Use Docker or PM2 for running microservices in production.

Configure environment variables in your deployment environment.

Ensure RabbitMQ, Redis, and MongoDB are accessible to all services.

ğŸ‘¥ Contributors

Abhay Pratap Verma â€” Lead Developer
(Add more contributors if applicable)

ğŸªª License

This project is licensed under the MIT License â€” feel free to use and modify.
```

MORE DETAILED INSTRUCTIONS
# Chat App (Microservices)

## Project Overview

This repository contains a microservices-based chat application split into three backend services and a frontend:

- backend/user â€” Handles user authentication (OTP), user profile, and user management.
  - Key files: [backend/user/src/index.ts](backend/user/src/index.ts), [`loginUser`](backend/user/src/controllers/user.ts), [`verifyUser`](backend/user/src/controllers/user.ts)
- backend/mail â€” Mail service that consumes RabbitMQ messages to send OTP emails.
  - Key files: [backend/mail/src/index.ts](backend/mail/src/index.ts), [`startSendOtpConsumer`](backend/mail/src/consumer.ts)
- backend/chat â€” Chat service that manages chats and messages, uploads images to Cloudinary.
  - Key files: [backend/chat/src/index.ts](backend/chat/src/index.ts), [`createNewChat`](backend/chat/src/controllers/chat.ts), [`sendMessage`](backend/chat/src/controllers/chat.ts)
- frontend â€” Client application (folder present but implementation details not included in workspace snapshot).

Purpose: allow users to login via OTP email, create chats with other users, send text and image messages, and fetch chat lists with unseen message counts.

Tech stack

- Node.js + TypeScript (each service has its own tsconfig and package.json)
  - [backend/user/package.json](backend/user/package.json)
  - [backend/chat/package.json](backend/chat/package.json)
  - [backend/mail/package.json](backend/mail/package.json)
- Express (HTTP APIs) â€” used in each service
- MongoDB with Mongoose â€” data persistence (models in each service)
  - [`User`](backend/user/src/model/User.ts)
  - [`Chat`](backend/chat/src/models/Chat.ts)
  - [`Messages`](backend/chat/src/models/Messages.ts)
- Redis â€” temporary storage for OTPs and rate-limiting (used by user service) [backend/user/src/index.ts](backend/user/src/index.ts)
- RabbitMQ â€” messaging between user service and mail service ([backend/user/src/config/rabbitmq.ts](backend/user/src/config/rabbitmq.ts), [backend/mail/src/consumer.ts](backend/mail/src/consumer.ts))
- Cloudinary â€” image upload/storage for chat images ([backend/chat/src/config/cloudinary.ts](backend/chat/src/config/cloudinary.ts))
- Nodemailer â€” actually sends email from the mail service ([backend/mail/src/consumer.ts](backend/mail/src/consumer.ts))

Key features

- OTP-based login flow with Redis-backed OTP storage and rate-limiting ([backend/user/src/controllers/user.ts](backend/user/src/controllers/user.ts))

- Pub/sub for sending emails via RabbitMQ ([backend/user/src/config/rabbitmq.ts](backend/user/src/config/rabbitmq.ts), [backend/mail/src/consumer.ts](backend/mail/src/consumer.ts))

- Chat creation, message storage, latest message tracking, unseen count ([backend/chat/src/controllers/chat.ts](backend/chat/src/controllers/chat.ts))

- Image upload using Cloudinary and multer storage ([backend/chat/src/middlewares/multer.ts](backend/chat/src/middlewares/multer.ts), [backend/chat/src/config/cloudinary.ts](backend/chat/src/config/cloudinary.ts))

- JWT-based authentication: token generation and verification ([backend/user/src/config/generateToken.ts](backend/user/src/config/generateToken.ts), [backend/user/src/middleware/isAuth.ts](backend/user/src/middleware/isAuth.ts), [backend/chat/src/middlewares/isAuth.ts](backend/chat/src/middlewares/isAuth.ts))

---

## System Architecture

Folder structure (high-level)

- backend/
  - user/ â€” user service (OTP, user CRUD)
    - src/
      - controllers/ ([backend/user/src/controllers/user.ts](backend/user/src/controllers/user.ts))
      - config/ ([backend/user/src/config/db.ts](backend/user/src/config/db.ts), [backend/user/src/config/rabbitmq.ts](backend/user/src/config/rabbitmq.ts))
      - middleware/ ([backend/user/src/middleware/isAuth.ts](backend/user/src/middleware/isAuth.ts))
      - model/ ([backend/user/src/model/User.ts](backend/user/src/model/User.ts))
      - routes/ ([backend/user/src/routes/user.ts](backend/user/src/routes/user.ts))
      - index.ts ([backend/user/src/index.ts](backend/user/src/index.ts))
  - chat/ â€” chat service (chats & messages)
    - src/
      - controllers/ ([backend/chat/src/controllers/chat.ts](backend/chat/src/controllers/chat.ts))
      - models/ ([backend/chat/src/models/Chat.ts](backend/chat/src/models/Chat.ts), [backend/chat/src/models/Messages.ts](backend/chat/src/models/Messages.ts))
      - middlewares/ ([backend/chat/src/middlewares/isAuth.ts](backend/chat/src/middlewares/isAuth.ts), [backend/chat/src/middlewares/multer.ts](backend/chat/src/middlewares/multer.ts))
      - config/ ([backend/chat/src/config/db.ts](backend/chat/src/config/db.ts), [backend/chat/src/config/cloudinary.ts](backend/chat/src/config/cloudinary.ts))
      - routes/ ([backend/chat/src/routes/chat.ts](backend/chat/src/routes/chat.ts))
      - index.ts ([backend/chat/src/index.ts](backend/chat/src/index.ts))
  - mail/ â€” mail worker service
    - src/
      - consumer.ts ([backend/mail/src/consumer.ts](backend/mail/src/consumer.ts))
      - index.ts ([backend/mail/src/index.ts](backend/mail/src/index.ts))

Inter-service communication

- The user service publishes messages to RabbitMQ queue `"send-otp"` via [`publishToQueue`](backend/user/src/config/rabbitmq.ts). The mail service listens to `"send-otp"` via [`startSendOtpConsumer`](backend/mail/src/consumer.ts) and sends emails.
- The chat service calls the user service HTTP API to fetch user info when listing chats:
  - Chat uses axios to call `${process.env.USER_SERVICE}/api/v1/user/:id` ([backend/chat/src/controllers/chat.ts](backend/chat/src/controllers/chat.ts)).
- Authentication uses JWT tokens issued by user service: [`generateToken`](backend/user/src/config/generateToken.ts) creates tokens; both user and chat services verify tokens in their `isAuth` middlewares ([backend/user/src/middleware/isAuth.ts](backend/user/src/middleware/isAuth.ts), [backend/chat/src/middlewares/isAuth.ts](backend/chat/src/middlewares/isAuth.ts)).

Design decisions & patterns

- Microservices: separation of concerns (auth/user, chat/messages, mail worker).
- Message-driven email delivery (RabbitMQ) to decouple mail sending from auth flow and improve scalability.
- Redis used for ephemeral OTP data and rate-limiting to protect OTP endpoint.
- Try/Catch wrapper `TryCatch` used to centralize async error handling across controllers ([backend/user/src/config/TryCatch.ts](backend/user/src/config/TryCatch.ts), [backend/chat/src/config/TryCatch.ts](backend/chat/src/config/TryCatch.ts)).
- Mongoose for schema enforcement and data modeling.

---

## Setup and Installation (Local)

Prerequisites

- Node.js >= 18
- npm
- MongoDB (local or cloud)
- Redis
- RabbitMQ
- Cloudinary account (if testing image uploads)
- SMTP credentials for mail service (Gmail or other)

Common environment variables (examples below). Each service has its own `.env`.

1. Clone repository

```sh
git clone <repo_url>
cd <repo_root>


